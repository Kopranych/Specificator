/*
 * Create_spec.c
 *
 *  Created on: 7 мая 2016 г.
 *      Author: Копраныч
 */

#include "Create_spec.h"
#include "logger.h"

#define INPUT_ARRAY_LEN 40
#define TYPE_INT 4
#define SIZE_ELEMENT 20

int device_spec(char *name, int number)
{
	FILE *sp; // создаем указатель на структуру типа FILE
	assert (strlen(name) < INPUT_ARRAY_LEN);
	int check_size = sizeof(number);
	assert (check_size == TYPE_INT);
	device specif[number]; //создаем массив структур типа device с именем specif и размером size_struct
	int i = 0; // обьявляем интовую переменную
	const char *extention = ".txt"; //сохраняем расширение будущего файла спецификации

	if ((sp = fopen(strcat(name, extention), "a+")) == NULL) //создаем/открывем фаил в режиме записи/чтения с именем и присваиваем ему расширение
	{ //с помощью функции strcat(главное обеспечить расширению достаточно места)если фаил создался без ошибок то продолжаем,иначе
		logger->error("Error opening file\n");
		printf("ERROR\n");          //иначе произошла ошибка
		exit(1);          //выходим
	}

	while (i < number)   // задаем предел создания элементов в спецификации
	{

		scanf("%s %d", specif[i].element, &(specif[i].number)); //ввод элементов i-той структуры
		logger->info("Enter elements\n");
		assert (strlen(specif[i].element) < SIZE_ELEMENT);
		int check_size = sizeof(specif[i].number);
		assert (check_size == TYPE_INT);
		if (!(strcmp("commit_spec", specif[i].element))) //проверяем если один из введенных значений "commit_spec"
		{
			logger->info("finished typing\n");
			break;          // то заканчиваем ввод данных
		}
		else          //иначе
		{
			logger->info("Write data in file\n")
			fprintf(sp, "%s %d\n", specif[i].element, specif[i].number); //выводим данные в фаил
			assert(sp);
		}
		i++;          //переходим к следующей i-той структуре
	}

	printf("spec was commited\n"); //когда закончили вводить данные печатаем на экран "spec was commited"
	fclose(sp);          //закрываем поток файлов
	return 0;          //
}

int complect(char *name, int number)
{
	FILE *sp;

	int i = 0;
	const char *extention = ".txt"; //сохраняем расширение будущего файла спецификации

	if ((sp = fopen(strcat(name, extention), "a+")) == NULL)
	{
		logger->error("Error opening file\n");
		printf("ERROR\n");
		exit(1);
	}
	device specif[number];
	while (fscanf(sp, "%s %d", specif[i].element, &(specif[i].number)) != EOF)
	{
		logger->info("Read elements\n");
		fprintf(stdout, "%s %d", specif[i].element, specif[i].number);
		fprintf(stdout, "\r\n");
		i++;
	}
	fclose(sp);
	return 0;
}
